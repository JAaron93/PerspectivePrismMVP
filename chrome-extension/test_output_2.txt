
> perspective-prism-chrome-extension@1.0.0 test
> vitest --run


 RUN  v2.1.9 /Users/pretermodernist/PerspectivePrism/chrome-extension

 ✓ tests/unit/setup.test.js (9 tests) 14ms
stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should return null for cache miss
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should retrieve cached data in under 500ms (requirement threshold)
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should retrieve cached data in under 100ms (ideal target)
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should consistently retrieve cache in under 500ms over multiple iterations
[PerspectivePrismClient] Recovery complete

 ✓ tests/unit/config-validator.test.js (26 tests) 26ms
stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Cache Hit/Miss Tracking > should record cache hits
[MetricsTracker] Cache hit for video123. Total hits: 1
[MetricsTracker] Cache hit for video456. Total hits: 2

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Cache Hit/Miss Tracking > should record cache misses
[MetricsTracker] Cache miss for video123. Total misses: 1
[MetricsTracker] Cache miss for video456. Total misses: 2

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Cache Hit/Miss Tracking > should calculate hit rate correctly
[MetricsTracker] Cache hit for video1. Total hits: 1
[MetricsTracker] Cache hit for video2. Total hits: 2
[MetricsTracker] Cache hit for video3. Total hits: 3
[MetricsTracker] Cache miss for video4. Total misses: 1

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should record eviction events
[MetricsTracker] Eviction: 3 entries, freed 500.00 KB, reason: quota_pressure

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should limit eviction history to MAX_METRICS_HISTORY
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should return recent evictions in reverse chronological order
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should return recent evictions in reverse chronological order
[MetricsTracker] Eviction: 1 entries, freed 2.00 KB, reason: quota_pressure

stdout | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should measure baseline memory usage under 10MB
Baseline memory usage: 10MB

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should measure baseline memory usage under 10MB
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should track memory measurements
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should return data for cache hit with valid entry
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should return recent evictions in reverse chronological order
[MetricsTracker] Eviction: 1 entries, freed 3.00 KB, reason: expiration

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should consistently retrieve cache in under 500ms over multiple iterations
Cache Performance Statistics (20 iterations):
  Average: 3.23ms
  Maximum: 5.69ms
  P95: 4.89ms

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should handle cache miss quickly (under 100ms)
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should retrieve cache with migration in under 500ms
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should return null for expired entry
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should retrieve cache with migration in under 500ms
[PerspectivePrismClient] Migrating cache entry from v0 to v1
[PerspectivePrismClient] Saving migrated entry for abcdefghijk

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should not block on lastAccessed update
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should handle large cache entries efficiently
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Metrics Reset > should reset all metrics
[MetricsTracker] Cache hit for video1. Total hits: 1
[MetricsTracker] Cache miss for video2. Total misses: 1
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Metrics reset

stdout | tests/unit/cache-size-monitoring.test.js > QuotaManager Integration > Eviction Event Logging > should log eviction events when quota is exceeded
[QuotaManager] Evicting cache_video1 (0.19 KB)
[QuotaManager] Evicting cache_video2 (0.19 KB)
[QuotaManager] Evicting cache_video3 (0.19 KB)
[QuotaManager] Evicted 3 entries, freed 0.57 KB
[MetricsTracker] Eviction: 3 entries, freed 0.57 KB, reason: quota_pressure

stderr | tests/unit/cache-size-monitoring.test.js > QuotaManager Integration > Eviction Event Logging > should log eviction events when quota is exceeded
[QuotaManager] Entry is oversized (1024.00 KB). Cannot fit in quota.

stdout | tests/unit/cache-size-monitoring.test.js > Cache Size Monitoring Integration > should provide complete monitoring data
[MetricsTracker] Cache hit for video1. Total hits: 1
[MetricsTracker] Cache hit for video2. Total hits: 2
[MetricsTracker] Cache miss for video3. Total misses: 1
[MetricsTracker] Eviction: 2 entries, freed 2.00 KB, reason: lru

 ✓ tests/unit/cache-size-monitoring.test.js (17 tests) 95ms
 ✓ tests/unit/cache-performance.test.js (7 tests) 121ms
stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should track memory measurements
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should return null for expired entry
[PerspectivePrismClient] Cache expired for abcdefghijk

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should migrate old schema versions
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should migrate old schema versions
[PerspectivePrismClient] Migrating cache entry from v0 to v1
[PerspectivePrismClient] Saving migrated entry for abcdefghijk

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should discard future schema versions
[PerspectivePrismClient] Recovery complete

stdout | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should track memory measurements
Memory stats: {
  count: 4,
  avgUsedMB: '10.00',
  maxUsedMB: '10.00',
  minUsedMB: '10.00',
  currentUsedMB: '10.00',
  currentPercentUsed: '10.00',
  warningThresholdMB: 8,
  criticalThresholdMB: 10
}

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should track memory measurements
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stdout | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should handle memory monitoring start/stop
[MemoryMonitor] Starting memory monitoring (interval: 1000ms)
[MemoryMonitor] Stopped memory monitoring

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should handle memory monitoring start/stop
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should export measurements
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should calculate statistics correctly
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should discard future schema versions
[PerspectivePrismClient] Cache entry version 999 is newer than supported 1

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should discard future schema versions
[PerspectivePrismClient] Cache entry corrupted or migration failed for abcdefghijk

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should store entry with correct structure
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should add schemaVersion to entry
[PerspectivePrismClient] Recovery complete

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should calculate statistics correctly
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should reject entries > 1 MB
[PerspectivePrismClient] Recovery complete

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should calculate statistics correctly
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stdout | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should maintain memory under 10MB during simulated operations
After 1 analyses: 10MB

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should maintain memory under 10MB during simulated operations
[MemoryMonitor] CRITICAL: Memory usage at 10MB (limit: 10MB)
[MemoryMonitor] CRITICAL MEMORY USAGE - Initiating emergency cleanup

stderr | tests/integration/test-memory-usage.test.js > Memory Leak Detection > should not leak memory with repeated measurements
[MemoryMonitor] performance.memory API not available

stderr | tests/integration/test-memory-usage.test.js > Memory Leak Detection > should limit stored measurements to MAX_MEASUREMENTS
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available

stdout | tests/integration/test-memory-usage.test.js > Memory Monitor Debug Mode > should enable and disable debug mode
[MemoryMonitor] Debug mode enabled
[MemoryMonitor] Debug mode disabled

 ❯ tests/integration/test-memory-usage.test.js (11 tests | 3 failed) 472ms
   × Memory Usage Tests > should measure baseline memory usage under 10MB 19ms
     → expected 10 to be less than 10
   × Memory Usage Tests > should maintain memory under 10MB during simulated operations 2ms
     → expected 10 to be less than 10
   × Memory Leak Detection > should not leak memory with repeated measurements 1ms
     → Cannot read properties of null (reading 'usedMB')
stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should reject entries > 1 MB
[PerspectivePrismClient] Entry too large to cache for abcdefghijk: 7.11 MB (max: 1 MB)

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should validate data before caching
[PerspectivePrismClient] Recovery complete

stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should validate data before caching
[PerspectivePrismClient] Refusing to cache invalid data for abcdefghijk: ValidationError: Invalid or missing video_id: must be an 11-character string
    at PerspectivePrismClient.validateAnalysisData (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:1182:13)
    at PerspectivePrismClient.saveToCache (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:580:12)
    at /Users/pretermodernist/PerspectivePrism/chrome-extension/tests/unit/client-cache.test.js:233:20
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > isExpired() > should return true for expired entries
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > isExpired() > should return false for fresh entries
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > isExpired() > should return true for missing timestamp
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > enforceCacheLimits() > should evict oldest entries when over MAX_CACHE_ITEMS
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > enforceCacheLimits() > should evict oldest entries when over MAX_CACHE_ITEMS
[PerspectivePrismClient] Evicting 1 items from cache

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > enforceCacheLimits() > should not evict if under limit
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > clearCache() > should remove all cache entries
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > clearCache() > should remove all cache entries
[PerspectivePrismClient] Clearing 2 cache items

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > remove() > should remove specific cache entry
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > remove() > should remove specific cache entry
[PerspectivePrismClient] Removed cache entry for abcdefghijk

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > cleanupExpiredCache() > should remove only expired entries
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > cleanupExpiredCache() > should remove only expired entries
[PerspectivePrismClient] Cleaning up 2 expired cache items

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should apply V0→V1 migration
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should apply V0→V1 migration
[PerspectivePrismClient] Migrating cache entry from v0 to v1

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should return entry if already current version
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should return null for invalid data in V0→V1
[PerspectivePrismClient] Recovery complete

stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should return null for invalid data in V0→V1
[PerspectivePrismClient] V0->V1 Migration: Data validation failed: ValidationError: Missing metadata object
    at PerspectivePrismClient.validateAnalysisData (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:1189:13)
    at PerspectivePrismClient.migrateV0ToV1 (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:921:12)
    at /Users/pretermodernist/PerspectivePrism/chrome-extension/tests/unit/client-cache.test.js:428:29
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > estimateSize() > should calculate entry size in bytes
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > estimateSize() > should handle circular references gracefully
[PerspectivePrismClient] Recovery complete

stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > estimateSize() > should handle circular references gracefully
[PerspectivePrismClient] Failed to estimate entry size: TypeError: Converting circular structure to JSON
    --> starting at object with constructor 'Object'
    --- property 'self' closes the circle
    at JSON.stringify (<anonymous>)
    at PerspectivePrismClient.estimateSize (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:654:31)
    at /Users/pretermodernist/PerspectivePrism/chrome-extension/tests/unit/client-cache.test.js:455:27
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)

 ✓ tests/unit/client-cache.test.js (22 tests) 1321ms

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 3 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Usage Tests > should measure baseline memory usage under 10MB
AssertionError: expected 10 to be less than 10
 ❯ tests/integration/test-memory-usage.test.js:54:20
     52| 
     53|     // Baseline should be well under 10MB
     54|     expect(usedMB).toBeLessThan(10);
       |                    ^
     55| 
     56|     // Ideally under 5MB for baseline

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/3]⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Usage Tests > should maintain memory under 10MB during simulated operations
AssertionError: expected 10 to be less than 10
 ❯ tests/integration/test-memory-usage.test.js:175:22
    173| 
    174|       // Should stay under 10MB
    175|       expect(usedMB).toBeLessThan(10);
       |                      ^
    176|     }
    177| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/3]⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Leak Detection > should not leak memory with repeated measurements
TypeError: Cannot read properties of null (reading 'usedMB')
 ❯ tests/integration/test-memory-usage.test.js:207:42
    205|     // Take initial measurement
    206|     const initial = await memoryMonitor.measure();
    207|     const initialMB = parseFloat(initial.usedMB);
       |                                          ^
    208| 
    209|     // Take many measurements

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/3]⎯

 Test Files  1 failed | 5 passed (6)
      Tests  3 failed | 89 passed (92)
   Start at  17:51:46
   Duration  4.25s (transform 235ms, setup 116ms, collect 342ms, tests 2.05s, environment 9.23s, prepare 1.86s)

