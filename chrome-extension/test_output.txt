
> perspective-prism-chrome-extension@1.0.0 test
> vitest --run


 RUN  v2.1.9 /Users/pretermodernist/PerspectivePrism/chrome-extension

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should return null for cache miss
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Cache Hit/Miss Tracking > should record cache hits
[MetricsTracker] Cache hit for video123. Total hits: 1
[MetricsTracker] Cache hit for video456. Total hits: 2

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Cache Hit/Miss Tracking > should record cache misses
[MetricsTracker] Cache miss for video123. Total misses: 1
[MetricsTracker] Cache miss for video456. Total misses: 2

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Cache Hit/Miss Tracking > should calculate hit rate correctly
[MetricsTracker] Cache hit for video1. Total hits: 1
[MetricsTracker] Cache hit for video2. Total hits: 2
[MetricsTracker] Cache hit for video3. Total hits: 3
[MetricsTracker] Cache miss for video4. Total misses: 1

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should record eviction events
[MetricsTracker] Eviction: 3 entries, freed 500.00 KB, reason: quota_pressure

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should limit eviction history to MAX_METRICS_HISTORY
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should return recent evictions in reverse chronological order
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should return recent evictions in reverse chronological order
[MetricsTracker] Eviction: 1 entries, freed 2.00 KB, reason: quota_pressure

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should retrieve cached data in under 500ms (requirement threshold)
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Eviction Event Tracking > should return recent evictions in reverse chronological order
[MetricsTracker] Eviction: 1 entries, freed 3.00 KB, reason: expiration

 ✓ tests/unit/setup.test.js (9 tests) 37ms
stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should return data for cache hit with valid entry
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should retrieve cached data in under 100ms (ideal target)
[PerspectivePrismClient] Recovery complete

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should measure baseline memory usage under 10MB
[MemoryMonitor] performance.memory API not available

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should track memory measurements
[MemoryMonitor] performance.memory API not available

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should consistently retrieve cache in under 500ms over multiple iterations
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should return null for expired entry
[PerspectivePrismClient] Recovery complete

 ✓ tests/unit/cache-size-monitoring.test.js (17 tests) 149ms
stdout | tests/unit/cache-size-monitoring.test.js > MetricsTracker > Metrics Reset > should reset all metrics
[MetricsTracker] Cache hit for video1. Total hits: 1
[MetricsTracker] Cache miss for video2. Total misses: 1
[MetricsTracker] Eviction: 1 entries, freed 1.00 KB, reason: lru
[MetricsTracker] Metrics reset

stdout | tests/unit/cache-size-monitoring.test.js > QuotaManager Integration > Eviction Event Logging > should log eviction events when quota is exceeded
[QuotaManager] Evicting cache_video1 (0.19 KB)
[QuotaManager] Evicting cache_video2 (0.19 KB)
[QuotaManager] Evicting cache_video3 (0.19 KB)
[QuotaManager] Evicted 3 entries, freed 0.57 KB
[MetricsTracker] Eviction: 3 entries, freed 0.57 KB, reason: quota_pressure

stderr | tests/unit/cache-size-monitoring.test.js > QuotaManager Integration > Eviction Event Logging > should log eviction events when quota is exceeded
[QuotaManager] Entry is oversized (1024.00 KB). Cannot fit in quota.

stdout | tests/unit/cache-size-monitoring.test.js > Cache Size Monitoring Integration > should provide complete monitoring data
[MetricsTracker] Cache hit for video1. Total hits: 1
[MetricsTracker] Cache hit for video2. Total hits: 2
[MetricsTracker] Cache miss for video3. Total misses: 1
[MetricsTracker] Eviction: 2 entries, freed 2.00 KB, reason: lru

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should consistently retrieve cache in under 500ms over multiple iterations
Cache Performance Statistics (20 iterations):
  Average: 2.65ms
  Maximum: 5.16ms
  P95: 4.54ms

 ✓ tests/unit/config-validator.test.js (26 tests) 58ms
stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should handle cache miss quickly (under 100ms)
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should retrieve cache with migration in under 500ms
[PerspectivePrismClient] Recovery complete
[PerspectivePrismClient] Migrating cache entry from v0 to v1
[PerspectivePrismClient] Saving migrated entry for abcdefghijk

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should not block on lastAccessed update
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/cache-performance.test.js > Cache Performance Tests > should handle large cache entries efficiently
[PerspectivePrismClient] Recovery complete

 ✓ tests/unit/cache-performance.test.js (7 tests) 117ms
stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should return null for expired entry
[PerspectivePrismClient] Cache expired for abc123def45

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should migrate old schema versions
[PerspectivePrismClient] Recovery complete

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should track memory measurements
[MemoryMonitor] performance.memory API not available

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should migrate old schema versions
[PerspectivePrismClient] Migrating cache entry from v0 to v1
[PerspectivePrismClient] Saving migrated entry for abc123def45

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should discard future schema versions
[PerspectivePrismClient] Recovery complete

stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should discard future schema versions
[PerspectivePrismClient] Cache entry version 999 is newer than supported 1

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > checkCache() > should discard future schema versions
[PerspectivePrismClient] Cache entry corrupted or migration failed for abc123def45

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should store entry with correct structure
[PerspectivePrismClient] Recovery complete

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should track memory measurements
[MemoryMonitor] performance.memory API not available

stdout | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should handle memory monitoring start/stop
[MemoryMonitor] Starting memory monitoring (interval: 1000ms)
[MemoryMonitor] Stopped memory monitoring

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should handle memory monitoring start/stop
[MemoryMonitor] performance.memory API not available

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should export measurements
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should calculate statistics correctly
[MemoryMonitor] performance.memory API not available

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should add schemaVersion to entry
[PerspectivePrismClient] Recovery complete

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should calculate statistics correctly
[MemoryMonitor] performance.memory API not available

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should reject entries > 1 MB
[PerspectivePrismClient] Recovery complete

stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should reject entries > 1 MB
[PerspectivePrismClient] Entry too large to cache for abc123def45: 7.11 MB (max: 1 MB)

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should validate data before caching
[PerspectivePrismClient] Recovery complete

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should calculate statistics correctly
[MemoryMonitor] performance.memory API not available

stderr | tests/integration/test-memory-usage.test.js > Memory Usage Tests > should maintain memory under 10MB during simulated operations
[MemoryMonitor] performance.memory API not available

stderr | tests/integration/test-memory-usage.test.js > Memory Leak Detection > should not leak memory with repeated measurements
[MemoryMonitor] performance.memory API not available

stderr | tests/integration/test-memory-usage.test.js > Memory Leak Detection > should limit stored measurements to MAX_MEASUREMENTS
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available
[MemoryMonitor] performance.memory API not available

stdout | tests/integration/test-memory-usage.test.js > Memory Monitor Debug Mode > should enable and disable debug mode
[MemoryMonitor] Debug mode enabled
[MemoryMonitor] Debug mode disabled

 ❯ tests/integration/test-memory-usage.test.js (11 tests | 7 failed) 455ms
   × Memory Usage Tests > should have performance.memory API available 14ms
     → expected undefined to be defined
   × Memory Usage Tests > should measure baseline memory usage under 10MB 4ms
     → Cannot read properties of null (reading 'usedMB')
   × Memory Usage Tests > should track memory measurements 204ms
     → expected 0 to be greater than or equal to 3
   × Memory Usage Tests > should export measurements 1ms
     → expected 0 to be greater than 0
   × Memory Usage Tests > should calculate statistics correctly 209ms
     → expected 0 to be greater than 0
   × Memory Usage Tests > should maintain memory under 10MB during simulated operations 1ms
     → Cannot read properties of null (reading 'usedMB')
   × Memory Leak Detection > should not leak memory with repeated measurements 1ms
     → Cannot read properties of null (reading 'usedMB')
stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > saveToCache() > should validate data before caching
[PerspectivePrismClient] Refusing to cache invalid data for abc123def45: ValidationError: Invalid or missing video_id: must be an 11-character string
    at PerspectivePrismClient.validateAnalysisData (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:1182:13)
    at PerspectivePrismClient.saveToCache (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:580:12)
    at /Users/pretermodernist/PerspectivePrism/chrome-extension/tests/unit/client-cache.test.js:233:20
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > isExpired() > should return true for expired entries
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > isExpired() > should return false for fresh entries
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > isExpired() > should return true for missing timestamp
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > enforceCacheLimits() > should evict oldest entries when over MAX_CACHE_ITEMS
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > enforceCacheLimits() > should evict oldest entries when over MAX_CACHE_ITEMS
[PerspectivePrismClient] Evicting 1 items from cache

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > enforceCacheLimits() > should not evict if under limit
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > clearCache() > should remove all cache entries
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > clearCache() > should remove all cache entries
[PerspectivePrismClient] Clearing 2 cache items

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > remove() > should remove specific cache entry
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > remove() > should remove specific cache entry
[PerspectivePrismClient] Removed cache entry for abc123def45

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > cleanupExpiredCache() > should remove only expired entries
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > cleanupExpiredCache() > should remove only expired entries
[PerspectivePrismClient] Cleaning up 2 expired cache items

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should apply V0→V1 migration
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should apply V0→V1 migration
[PerspectivePrismClient] Migrating cache entry from v0 to v1

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should return entry if already current version
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should return null for invalid data in V0→V1
[PerspectivePrismClient] Recovery complete

stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > Schema Migration > should return null for invalid data in V0→V1
[PerspectivePrismClient] V0->V1 Migration: Data validation failed: ValidationError: Missing metadata object
    at PerspectivePrismClient.validateAnalysisData (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:1189:13)
    at PerspectivePrismClient.migrateV0ToV1 (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:921:12)
    at /Users/pretermodernist/PerspectivePrism/chrome-extension/tests/unit/client-cache.test.js:428:29
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > estimateSize() > should calculate entry size in bytes
[PerspectivePrismClient] Recovery complete

stdout | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > estimateSize() > should handle circular references gracefully
[PerspectivePrismClient] Recovery complete

stderr | tests/unit/client-cache.test.js > PerspectivePrismClient - Cache Operations > estimateSize() > should handle circular references gracefully
[PerspectivePrismClient] Failed to estimate entry size: TypeError: Converting circular structure to JSON
    --> starting at object with constructor 'Object'
    --- property 'self' closes the circle
    at JSON.stringify (<anonymous>)
    at PerspectivePrismClient.estimateSize (/Users/pretermodernist/PerspectivePrism/chrome-extension/client.js:654:31)
    at /Users/pretermodernist/PerspectivePrism/chrome-extension/tests/unit/client-cache.test.js:455:27
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///Users/pretermodernist/PerspectivePrism/chrome-extension/node_modules/@vitest/runner/dist/index.js:1205:15)

 ✓ tests/unit/client-cache.test.js (22 tests) 1275ms

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 7 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Usage Tests > should have performance.memory API available
AssertionError: expected undefined to be defined
 ❯ tests/integration/test-memory-usage.test.js:25:32
     23|   
     24|   it('should have performance.memory API available', () => {
     25|     expect(performance.memory).toBeDefined();
       |                                ^
     26|     expect(performance.memory.usedJSHeapSize).toBeDefined();
     27|     expect(performance.memory.totalJSHeapSize).toBeDefined();

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/7]⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Usage Tests > should measure baseline memory usage under 10MB
TypeError: Cannot read properties of null (reading 'usedMB')
 ❯ tests/integration/test-memory-usage.test.js:35:24
     33|     
     34|     expect(measurement).toBeDefined();
     35|     expect(measurement.usedMB).toBeDefined();
       |                        ^
     36|     
     37|     const usedMB = parseFloat(measurement.usedMB);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/7]⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Usage Tests > should track memory measurements
AssertionError: expected 0 to be greater than or equal to 3
 ❯ tests/integration/test-memory-usage.test.js:59:25
     57|     const stats = memoryMonitor.getStats();
     58|     
     59|     expect(stats.count).toBeGreaterThanOrEqual(3);
       |                         ^
     60|     expect(stats.avgUsedMB).toBeDefined();
     61|     expect(stats.maxUsedMB).toBeDefined();

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/7]⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Usage Tests > should export measurements
AssertionError: expected 0 to be greater than 0
 ❯ tests/integration/test-memory-usage.test.js:85:33
     83|     
     84|     expect(Array.isArray(measurements)).toBe(true);
     85|     expect(measurements.length).toBeGreaterThan(0);
       |                                 ^
     86|     
     87|     // Verify measurement structure

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/7]⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Usage Tests > should calculate statistics correctly
AssertionError: expected 0 to be greater than 0
 ❯ tests/integration/test-memory-usage.test.js:108:41
    106|     
    107|     // Verify stats are reasonable
    108|     expect(parseFloat(stats.avgUsedMB)).toBeGreaterThan(0);
       |                                         ^
    109|     expect(parseFloat(stats.maxUsedMB)).toBeGreaterThanOrEqual(parseFl…
    110|     expect(parseFloat(stats.minUsedMB)).toBeLessThanOrEqual(parseFloat…

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/7]⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Usage Tests > should maintain memory under 10MB during simulated operations
TypeError: Cannot read properties of null (reading 'usedMB')
 ❯ tests/integration/test-memory-usage.test.js:147:45
    145|       // Measure after each addition
    146|       const measurement = await memoryMonitor.measure();
    147|       const usedMB = parseFloat(measurement.usedMB);
       |                                             ^
    148|       
    149|       console.log(`After ${i + 1} analyses: ${usedMB}MB`);

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/7]⎯

 FAIL  tests/integration/test-memory-usage.test.js > Memory Leak Detection > should not leak memory with repeated measurements
TypeError: Cannot read properties of null (reading 'usedMB')
 ❯ tests/integration/test-memory-usage.test.js:184:42
    182|     // Take initial measurement
    183|     const initial = await memoryMonitor.measure();
    184|     const initialMB = parseFloat(initial.usedMB);
       |                                          ^
    185|     
    186|     // Take many measurements

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/7]⎯

 Test Files  1 failed | 5 passed (6)
      Tests  7 failed | 85 passed (92)
   Start at  17:50:05
   Duration  4.70s (transform 131ms, setup 211ms, collect 145ms, tests 2.09s, environment 12.09s, prepare 1.87s)

